-- SQL Tag 5 22.08.25

-- Übungsaufgaben

/*
1. Lieferantennummern und Namen der Lieferanten, 
	die 3 verschiedene Artikel geliefert haben
2. Nummern, Namen und Wohnort der Lieferanten, die bereits
	geliefert haben und deren Statuswert größer als der
	durchschnittliche Statuswert aller Lieferanten ist.
3. durchschnittliche Liefermenge des Artikels "A01"
4. Anzahl der Lieferungen roter Artikel, die seit dem 05.05.90 
	durchgefüht wurden
5. Nummern, Namen, und Wohnorte der Lieferanten, deren Status kleiner
	als der von Lieferant L03 ist
*/

--1. Lieferantennummern und Namen der Lieferanten, 
--	die 3 verschiedene Artikel geliefert haben
SELECT a.lnr, lname FROM lieferant a JOIN lieferung b
ON a.lnr=b.lnr
GROUP BY a.lnr, lname
HAVING COUNT(DISTINCT anr) = 3;

-- oder
SELECT lnr, lname FROM lieferant
WHERE lnr IN (SELECT lnr FROM lieferung
				GROUP BY lnr
				HAVING COUNT(anr) = 3);

-- oder
SELECT DISTINCT a.lnr, lname FROM lieferant a JOIN lieferung b
ON a.lnr=b.lnr
AND 3 = (SELECT COUNT(anr) FROM lieferung
			WHERE b.lnr=lnr
			GROUP BY lnr);


--2. Nummern, Namen und Wohnort der Lieferanten, die bereits
--	geliefert haben und deren Statuswert größer als der
--	durchschnittliche Statuswert aller Lieferanten ist.
SELECT lname, lnr, lstadt FROM lieferant
WHERE status > (SELECT AVG(status) FROM lieferant)
AND lnr IN (SELECT lnr FROM lieferung);

-- oder
SELECT lname, a.lnr, lstadt FROM lieferant a JOIN lieferung b
ON a.lnr=b.lnr
AND status > (SELECT AVG(status) FROM lieferant);


--3. durchschnittliche Liefermenge des Artikels "A01"
SELECT AVG(lmenge) AS 'Durchschnitt' FROM lieferung
WHERE anr= 'A01';

--4. Anzahl der Lieferungen roter Artikel, die seit dem 05.05.90 
--	durchgefüht wurden
SELECT COUNT(b.anr) FROM lieferung a JOIN artikel b
ON a.anr=b.anr
WHERE farbe = 'rot'
AND ldatum >= '05.05.1990';

-- oder
SELECT COUNT(lmenge) FROM lieferung
WHERE ldatum >= '05.05.1990'
AND anr IN (SELECT anr FROM artikel
			WHERE farbe = 'rot');

--5. Nummern, Namen, und Wohnorte der Lieferanten, deren Status kleiner
--	als der von Lieferant L03 ist
SELECT lnr, lname, lstadt,status FROM lieferant
WHERE status < (SELECT status FROM lieferant
				WHERE lnr='L03');

-- oder
SELECT a.lnr, a.lname, a.lstadt FROM lieferant a JOIN lieferant b
ON a.status<b.status
AND b.lnr='L03';

--6.  Gesamtliefermenge aller Lieferungen des Artikels A01 durch den Lieferanten L02
SELECT SUM(lmenge) AS 'Gesamtliefermenge' FROM lieferung
WHERE anr='A01'
AND lnr='L02';

--7. Der Lieferant Okupenko zieht jetzt nach Hamburg um (weil Küstennebel und so)
UPDATE lieferant SET lstadt='Hamburg'
WHERE lname= 'Okupenko';

SELECT * FROM lieferant;


